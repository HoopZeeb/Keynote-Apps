<h4>Performance - <?php echo $this->vPageCompoments?></h4>
<p>
Average time for full page(s) download.  Data is compared to last 28 days of history
<span class="label label-warning">15% - 25% above last 28 days</span>
<span class="label label-important">&gt; 25% above last 28 days</span>
</p>
<table class="table table-condensed table-bordered table-striped">
<?php

$warnCellColor = '#f89406; font-weight: bold; color: #FFFFFF';
$critCellColor = '#953b39; font-weight: bold; color: #FFFFFF';

$displayDate = '<th>Alias</th>';
for ($i = 7; $i >= 1; $i--) {
    $date = strtotime(date("Y-m-d", strtotime($this->currentDay)) . " -" . $i ." day");
    $displayDate .= '<th style="text-align:right">' . date('j M', $date) . '</th>';
}

$displayDate .='<th style="text-align:right">28 Days</th>' . PHP_EOL;
$displayDate .='<th style="text-align:right">21 Days</th>' . PHP_EOL;
$displayDate .='<th style="text-align:right">14 Days</th>' . PHP_EOL;
$displayDate .='<th style="text-align:right">7 Days</th>' . PHP_EOL;

echo '<tr>' . PHP_EOL . $displayDate . '</tr>' . PHP_EOL;

foreach ($this->perfData as $a => $p) {
    if (strstr($a, 'Total Time') || strstr($a, 'User Time')) {
        $avg[] = $p[7]['perf'];
    }
    if (strstr($a, 'Object Count')) {
        $avgObj[] = $p[7]['objects'];
    }
    if (strstr($a, 'Average Bytes')) {
        $avgBytes[] = $p[7]['bytes'];
    }
}

$c = 0;

foreach ($this->perfData as $a => $p) {
    if (strstr($a, 'Total Time') || strstr($a, 'User Time')) {
        $a = str_replace(' - Total Time (seconds)[Geo Mean]', '', $a);
        $a = str_replace(' - User Time (seconds)[Geo Mean]', '', $a);

        echo '<tr>' . PHP_EOL . '<td>' . $a . '</td>' . PHP_EOL;
        $getAvg = $avg[$c];
        $c++;
        foreach ($p as $pd) {
            $cellColor = '';
            if ($pd['perf'] != '-' && $getAvg != '-') {
                if (($pd['perf'] - $getAvg) / $pd['perf'] * 100 >= 15) {
                    $cellColor = $warnCellColor;
                }
                if (($pd['perf'] - $getAvg) / $pd['perf'] * 100 >= 25) {
                    $cellColor = $critCellColor;
                }
            }

            echo '<td style="text-align:right; background-color:' . $cellColor . '">' . $pd['perf'] . '</td>' . PHP_EOL;
        }
        echo '</tr>' . PHP_EOL;
    }
}

?>
</table>
<h4>Availability</h4>
<p>
Average percentage of successful measurements during the period
<span class="label label-warning">&lt; <?php echo $this->avail_warn ?>% &gt; <?php echo $this->avail_crit ?>%</span>
<span class="label label-important">&lt; <?php echo $this->avail_crit ?>%</span>
</p>
<table class="table table-condensed table-bordered table-striped">
<?php
echo $displayDate;
foreach ($this->perfData as $a => $p) {
    if (strstr($a, 'Total Time') || strstr($a, 'User Time')) {
        $a = str_replace(' - Total Time (seconds)[Geo Mean]', '', $a);
        $a = str_replace(' - User Time (seconds)[Geo Mean]', '', $a);

        echo '<tr><td>' . $a . '</td>';
        foreach ($p as $pd) {
            $cellColor = '';
            if ($pd['avail'] < $this->avail_warn && $pd['avail'] != '-') {
                $cellColor = $warnCellColor;
            }
            if ($pd['avail'] < $this->avail_crit && $pd['avail'] != '-') {
                $cellColor = $critCellColor;
            }
            echo '<td class="right" style="text-align: right; background-color:' . $cellColor . '">' . $pd['avail'];
            echo $pd['avail'] == '-' ? '' : '%';
            echo '</td>';
        }
        echo '</tr>';
    }
}
?>
</table>
<h4>Objects</h4>
<p>
Average Objects downloaded.  Data is compared to last 28 days of history
<span class="label label-warning">15% - 25% above last 28 days</span>
<span class="label label-important">&gt; 25% above last 28 days</span>
</p>
<table class="table table-condensed table-bordered table-striped">
<?php
echo $displayDate;
$c = 0;

foreach ($this->perfData as $a => $p) {
    if (strstr($a, 'Object Count')) {
        $a = str_replace(' - Object Count[Geo Mean]', '', $a);
        echo '<tr>' . PHP_EOL . '<td>' . $a . '</td>' . PHP_EOL;
        $getAvg = $avgObj[$c];
        $c++;
        foreach ($p as $pd) {
            $cellColor = '';
            if ($pd['objects'] != '-' && $getAvg != '-') {
                if (($pd['objects'] - $getAvg) / $pd['objects'] * 100 >= 15) {
                    $cellColor = $warnCellColor;
                }
                if (($pd['objects'] - $getAvg) / $pd['objects'] * 100 >= 25) {
                    $cellColor = $critCellColor;
                }
            }

            echo '<td style="text-align:right; background-color:' . $cellColor . '">' . $pd['objects'] . '</td>' . PHP_EOL;
        }
        echo '</tr>' . PHP_EOL;
    }
}
?>
</table>
<h4>Bytes Downloaded</h4>
<p>
Average bytes downloaded.  Data is compared to last 28 days of history
<span class="label label-warning">15% - 25% above last 28 days</span>
<span class="label label-important">&gt; 25% above last 28 days</span>
</p>
<table class="table table-condensed table-bordered table-striped">
<?php
echo $displayDate;
$c = 0;

foreach ($this->perfData as $a => $p) {
    if (strstr($a, 'Average Bytes')) {
        $a = str_replace(' - Average Bytes Downloaded[Geo Mean]', '', $a);

        echo '<tr>' . PHP_EOL . '<td>' . $a . '</td>' . PHP_EOL;
        $getAvg = $avgBytes[$c];
        $c++;
        foreach ($p as $pd) {
            $cellColor = '';
            if ($pd['bytes'] != '-' && $getAvg != '-') {
                if (($pd['bytes'] - $getAvg) / $pd['bytes'] * 100 >= 15) {
                    $cellColor = $warnCellColor;
                }
                if (($pd['bytes'] - $getAvg) / $pd['bytes'] * 100 >= 25) {
                    $cellColor = $critCellColor;
                }
            }
            echo '<td style="text-align:right; background-color:' . $cellColor . '">' . number_format($pd['bytes']  / 1024, 0, '.',',') . ' Kb</td>' . PHP_EOL;
        }
        echo '</tr>' . PHP_EOL;
    }
}
?>
</table>
